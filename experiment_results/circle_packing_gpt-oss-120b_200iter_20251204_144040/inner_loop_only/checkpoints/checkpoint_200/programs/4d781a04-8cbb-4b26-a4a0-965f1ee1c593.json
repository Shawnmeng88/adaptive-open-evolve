{"id": "4d781a04-8cbb-4b26-a4a0-965f1ee1c593", "code": "# EVOLVE-BLOCK-START\n\"\"\"Improved 26\u2011circle packing: hex seed + tiny local search, LP\u2011optimised radii.\"\"\"\nimport numpy as np\nfrom itertools import combinations\ntry:\n    from scipy.optimize import linprog\n    _LP = True\nexcept Exception:                     # pragma: no cover\n    _LP = False\n\n\ndef _hex_seed(n: int) -> np.ndarray:\n    \"\"\"Hexagonal seed (spacing tuned for 26 circles).\"\"\"\n    s = 0.18\n    dy = s * np.sqrt(3) / 2\n    pts = []\n    y, row = s / 2, 0\n    while y < 1 and len(pts) < n:\n        off = 0 if row % 2 == 0 else s / 2\n        x = s / 2 + off\n        while x < 1 and len(pts) < n:\n            pts.append([x, y])\n            x += s\n        y += dy\n        row += 1\n    pts = np.clip(np.array(pts[:n]), 0.01, 0.99)\n    if pts.shape[0] < n:                         # pad centre if needed\n        pts = np.vstack([pts, np.full((n - pts.shape[0], 2), 0.5)])\n    return pts\n\n\ndef _lp_radii(c: np.ndarray) -> np.ndarray:\n    \"\"\"LP maximise \u03a3r under border & pairwise constraints.\"\"\"\n    n = len(c)\n    bnd = np.minimum.reduce([c[:, 0], c[:, 1], 1 - c[:, 0], 1 - c[:, 1]])\n    rows, rhs = [], []\n    for i, j in combinations(range(n), 2):\n        r = np.zeros(n); r[i] = r[j] = 1.0\n        rows.append(r); rhs.append(np.linalg.norm(c[i] - c[j]))\n    A, b = (np.array(rows), np.array(rhs)) if rows else (None, None)\n    res = linprog(-np.ones(n), A_ub=A, b_ub=b, bounds=[(0, x) for x in bnd],\n                  method='highs', options={'presolve': True})\n    return res.x if res.success else bnd\n\n\ndef _heur_radii(c: np.ndarray) -> np.ndarray:\n    \"\"\"Fallback: pairwise scaling (always feasible).\"\"\"\n    r = np.minimum.reduce([c[:, 0], c[:, 1], 1 - c[:, 0], 1 - c[:, 1]])\n    for i, j in combinations(range(len(c)), 2):\n        d = np.linalg.norm(c[i] - c[j])\n        if r[i] + r[j] > d:\n            s = d / (r[i] + r[j])\n            r[i] *= s; r[j] *= s\n    return r\n\n\ndef _opt_radii(c: np.ndarray) -> np.ndarray:\n    return _lp_radii(c) if _LP else _heur_radii(c)\n\n\ndef _local_search(c: np.ndarray, steps=12, delta=0.012) -> np.ndarray:\n    \"\"\"Very cheap hill\u2011climb: move each centre \u00b1\u03b4 if it raises total radius.\"\"\"\n    best = c.copy()\n    best_sum = _opt_radii(best).sum()\n    for _ in range(steps):\n        improved = False\n        for i in range(len(best)):\n            for sign in (-1, 1):\n                cand = best.copy()\n                cand[i] += sign * delta\n                cand[i] = np.clip(cand[i], 0.01, 0.99)\n                s = _opt_radii(cand).sum()\n                if s > best_sum + 1e-6:\n                    best, best_sum = cand, s\n                    improved = True\n        if not improved:\n            break\n    return best\n\n\ndef construct_packing():\n    \"\"\"Return (centers, radii, sum_of_radii) for 26 circles.\"\"\"\n    seed = _hex_seed(26)\n    centers = _local_search(seed)\n    radii = _opt_radii(centers)\n    return centers, radii, float(radii.sum())\n\n\n# EVOLVE-BLOCK-END\n\n\ndef run_packing():\n    \"\"\"Entry\u2011point used by the evaluation harness.\"\"\"\n    return construct_packing()\n\n\ndef visualize(centers, radii):\n    \"\"\"Optional Matplotlib visualisation.\"\"\"\n    import matplotlib.pyplot as plt\n    from matplotlib.patches import Circle\n\n    fig, ax = plt.subplots(figsize=(6, 6))\n    ax.set_aspect('equal')\n    ax.set_xlim(0, 1)\n    ax.set_ylim(0, 1)\n    ax.grid(True)\n    for i, (c, r) in enumerate(zip(centers, radii)):\n        ax.add_patch(Circle(c, r, alpha=0.4))\n        ax.text(*c, str(i), ha='center', va='center')\n    plt.title(f'Packing \u2013 sum\u202f=\u202f{radii.sum():.4f}')\n    plt.show()\n\n\nif __name__ == '__main__':\n    cs, rs, total = run_packing()\n    print(f'Sum of radii: {total:.6f}')\n    # visualize(cs, rs)   # uncomment to see the layout", "language": "python", "parent_id": "07f1236a-406a-49a5-88af-972dc7b50606", "generation": 3, "timestamp": 1764881191.504294, "iteration_found": 21, "metrics": {"validity": 1.0, "sum_radii": 2.3316133740363183, "target_ratio": 0.8848627605450924, "combined_score": 0.8848627605450924, "eval_time": 0.8534400463104248}, "complexity": 0.0, "diversity": 0.0, "metadata": {"island": 4}, "prompts": null, "artifacts_json": null, "artifact_dir": null, "embedding": null}